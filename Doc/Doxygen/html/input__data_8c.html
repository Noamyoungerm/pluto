<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PLUTO: /Users/mignone/PLUTO/Src/input_data.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PLUTO
   &#160;<span id="projectnumber">4.4-patch2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_413f4e031a85da0d68269c6fd2f76e1c.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">input_data.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Provide basic functionality for reading input data files.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="pluto_8h_source.html">pluto.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a72edefcb22c423d02aeb0b19a50e85de"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="input__data_8c.html#a72edefcb22c423d02aeb0b19a50e85de">ID_NZ_MAX</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a72edefcb22c423d02aeb0b19a50e85de"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a65f5ad47ce954368ba12eddd9308d6ff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="input__data_8c.html#a65f5ad47ce954368ba12eddd9308d6ff">InputDataOpen</a> (char *data_fname, char *grid_fname, char *endianity, long int offset, int vpos)</td></tr>
<tr class="separator:a65f5ad47ce954368ba12eddd9308d6ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad91f24df5b7171924a9761fec3ee370e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="input__data_8c.html#ad91f24df5b7171924a9761fec3ee370e">InputDataClose</a> (int indx)</td></tr>
<tr class="separator:ad91f24df5b7171924a9761fec3ee370e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4f26270d00eab06728157ce3f593ddc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="input__data_8c.html#af4f26270d00eab06728157ce3f593ddc">InputDataGridSize</a> (int indx, int *size)</td></tr>
<tr class="separator:af4f26270d00eab06728157ce3f593ddc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a406f32a3bd0811bf35b305702a9dfb24"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="input__data_8c.html#a406f32a3bd0811bf35b305702a9dfb24">InputDataInterpolate</a> (int indx, double x1, double x2, double x3)</td></tr>
<tr class="separator:a406f32a3bd0811bf35b305702a9dfb24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f3c89a85866b4d6d3c4bc381341e806"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="input__data_8c.html#a8f3c89a85866b4d6d3c4bc381341e806">InputDataReadSlice</a> (int indx, int kslice)</td></tr>
<tr class="separator:a8f3c89a85866b4d6d3c4bc381341e806"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Collects a number of functions for opening, reading and interpolating initial conditions from user-supplied binary data file(s). The geometry and dimensions of the input grid can be different from the actual grid employed by PLUTO, as long as the coordinate geometry transformation has been implemented. The input grid and data files should employ the same format and conventions employed by PLUTO. Specifically:</p>
<ul>
<li>Gridfile: coordinates should be written using the standard PLUTO 4 grid format.</li>
<li>Datafile: variables should be written in single or multiple binary data file using eighter single or double precision. The file extension must be ".flt" or ".dbl" for the former and the latter, respectively.</li>
</ul>
<p><a class="el" href="input__data_8c.html#a65f5ad47ce954368ba12eddd9308d6ff">InputDataOpen()</a> initializes the inputData structure for a given input field (e.g. density) iby reading grid size and coordinates, geometry, precision, endianity, etc..</p>
<p><a class="el" href="input__data_8c.html#a406f32a3bd0811bf35b305702a9dfb24">InputDataInterpolate()</a> is used to interpolate the given field from the input coordinates to the desired coordinate location using bi- or tri-linear interpolation to fill the data array.</p>
<p>The input data is stored in a buffer by reading <a class="el" href="input__data_8c.html#a72edefcb22c423d02aeb0b19a50e85de">ID_NZ_MAX</a> planes at a time to save computational memory. The value of <a class="el" href="input__data_8c.html#a72edefcb22c423d02aeb0b19a50e85de">ID_NZ_MAX</a> can be changed from your personal <code>definitions.h</code>. This task is performed in the <a class="el" href="input__data_8c.html#a8f3c89a85866b4d6d3c4bc381341e806">InputDataReadSlice()</a> function.</p>
<dl class="section author"><dt>Authors</dt><dd>A. Mignone (<a href="#" onclick="location.href='mai'+'lto:'+'mig'+'no'+'ne@'+'to'+'.in'+'fn'+'.it'; return false;">migno<span style="display: none;">.nosp@m.</span>ne@t<span style="display: none;">.nosp@m.</span>o.inf<span style="display: none;">.nosp@m.</span>n.it</a>)<br />
</dd></dl>
<dl class="section date"><dt>Date</dt><dd>Nov 10, 2020 </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a72edefcb22c423d02aeb0b19a50e85de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72edefcb22c423d02aeb0b19a50e85de">&#9670;&nbsp;</a></span>ID_NZ_MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ID_NZ_MAX&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum size (in the 3rd dimension) of the input buffer. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad91f24df5b7171924a9761fec3ee370e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad91f24df5b7171924a9761fec3ee370e">&#9670;&nbsp;</a></span>InputDataClose()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InputDataClose </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>indx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free memory and reset structure. </p>

</div>
</div>
<a id="af4f26270d00eab06728157ce3f593ddc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4f26270d00eab06728157ce3f593ddc">&#9670;&nbsp;</a></span>InputDataGridSize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InputDataGridSize </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>indx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the size of the input data array, from the grid file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">indx</td><td>input data array element (handle) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>an array of integer containing the array size [nx1,nx2,nx3] </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a406f32a3bd0811bf35b305702a9dfb24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a406f32a3bd0811bf35b305702a9dfb24">&#9670;&nbsp;</a></span>InputDataInterpolate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double InputDataInterpolate </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>indx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>x1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>x2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>x3</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Perform bi- or tri-linear interpolation on external dataset to compute vs[] at the given point {x1,x2,x3}.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">indx</td><td>input data array element (handle) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x1</td><td>coordinate point at which at interpolates are desired </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x2</td><td>coordinate point at which at interpolates are desired </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x3</td><td>coordinate point at which at interpolates are desired</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The interpolated value.</dd></dl>
<p>The function performs the following tasks. </p>
<ul>
<li>Convert PLUTO coordinates to input grid geometry if necessary.</li>
<li>Make sure point (x1,x2,x3) does not fall outside input grid range. Limit to input grid edge otherwise.</li>
<li>Use table lookup by binary search to find the indices il, jl and kl such that grid points of PLUTO fall between [il, il+1], [jl, jl+1], [kl, kl+1].</li>
<li>Define normalized coordinates between [0,1]:<ul>
<li>x[il+1] &lt; x1[i] &lt; x[il+1] ==&gt; 0 &lt; xx &lt; 1</li>
<li>y[jl+1] &lt; x2[j] &lt; y[jl+1] ==&gt; 0 &lt; yy &lt; 1</li>
<li>z[kl+1] &lt; x3[k] &lt; z[kl+1] ==&gt; 0 &lt; zz &lt; 1</li>
</ul>
</li>
<li>Read data from disk (1 or 2 planes)</li>
<li>Perform bi- or tri-linear interpolation. </li>
</ul>

</div>
</div>
<a id="a65f5ad47ce954368ba12eddd9308d6ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65f5ad47ce954368ba12eddd9308d6ff">&#9670;&nbsp;</a></span>InputDataOpen()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int InputDataOpen </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data_fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>grid_fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>endianity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long int&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>vpos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize access to input data file by assigning values to grid-related information (geometry, number of points, etc...). This function should be called just once for input-data initialization.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data_fname</td><td>the name of the input binary data file </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grid_fname</td><td>the name of the corresponding grid file </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">endianity</td><td>an input string ("little" or "big") giving the byte-order of how the input data file was originally written. If an empty string is supplied, no change is made. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">offset</td><td>an integer specifying the offset of the variable (in units of double or float) in the file. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vpos</td><td>the variable position with respect to the cell center (CENTER / X1FACE / X2FACE / X3FACE).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The index of the id_stack[] array </dd></dl>
<p>0. Find the 1st available (NULL pointer) element in the stack</p>
<ol type="1">
<li>Scan grid data file and try to determine the grid geometry (<code>id-&gt;geom</code>). Search for tag "GEOMETRY:" and read the word that follows.</li>
<li>Move file pointer to the first line of grid.out that does not begin with a "\c #".</li>
<li>Read number of points, allocate grid arrays and store input grid coordinates into structure members <code>id-&gt;nx1</code>, <code>id-&gt;x1</code>, etc... In the case of a staggered direction [i] refers to the left interface and we increment by 1 the number of points.</li>
<li>Check if binary data file exists and allocate memory buffer <code>id-&gt;Vin</code> </li>
<li>Set endianity (<code>id-&gt;swap_endian</code>)</li>
<li>Set data size (<code>id-&gt;dsize</code>) by looking at the file extension (<code>dbl</code> or <code>flt</code>).</li>
<li>Compute offset (<code>id-&gt;offset</code> in bytes) and initialize <code>id-&gt;klast</code> (last read plane) to -1 </li>
</ol>

</div>
</div>
<a id="a8f3c89a85866b4d6d3c4bc381341e806"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f3c89a85866b4d6d3c4bc381341e806">&#9670;&nbsp;</a></span>InputDataReadSlice()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void InputDataReadSlice </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>indx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>kslice</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read <a class="el" href="input__data_8c.html#a72edefcb22c423d02aeb0b19a50e85de">ID_NZ_MAX</a> slices from disk starting at the kslice vertical index.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">indx</td><td>the structure index (file handle) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">kslice</td><td>the starting slice </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Jun 26 2021 13:23:57 for PLUTO by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
