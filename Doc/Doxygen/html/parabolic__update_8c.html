<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>PLUTO: /Users/mignone/PLUTO/Src/parabolic_update.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUTO
   &#160;<span id="projectnumber">4.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_413f4e031a85da0d68269c6fd2f76e1c.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">parabolic_update.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Compute right hand side from parabolic (diffusion) terms.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="pluto_8h_source.html">pluto.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac2ee01ca2562ef042f459a017ad32e9d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="parabolic__update_8c.html#ac2ee01ca2562ef042f459a017ad32e9d">ParabolicUpdate</a> (const <a class="el" href="struct_data.html">Data</a> *d, Data_Arr dU, <a class="el" href="struct_r_box.html">RBox</a> *domBox, double **aflux, double dt, <a class="el" href="structtime_step.html">timeStep</a> *Dts, <a class="el" href="struct_grid.html">Grid</a> *grid)</td></tr>
<tr class="separator:ac2ee01ca2562ef042f459a017ad32e9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefbc26d62209abbbb901c7e763517192"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="parabolic__update_8c.html#aefbc26d62209abbbb901c7e763517192">ParabolicRHS</a> (const <a class="el" href="struct_data.html">Data</a> *d, Data_Arr dU, <a class="el" href="struct_r_box.html">RBox</a> *domBox, double **aflux, int timeStepping, double dt, <a class="el" href="struct_grid.html">Grid</a> *grid)</td></tr>
<tr class="separator:aefbc26d62209abbbb901c7e763517192"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The <a class="el" href="parabolic__update_8c.html#ac2ee01ca2562ef042f459a017ad32e9d">ParabolicUpdate()</a> function computes the right hand side of conservative variables using contributions coming from diffusion operators only. It is called by EXPLICIT methods only immediately after the hyerbolic rhs has been computed. Note that this is <em>not</em> an operator split formalism since contributions are added as the same time level: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{array}{llc} (1)\quad &amp; \vec{R}^{n} &amp; = - \Delta t\nabla\cdot\vec{F}_h^n \\ \noalign{\medskip} (2)\quad &amp; \vec{R}^{n} &amp; += + \Delta t\nabla\cdot\vec{F}_p^n \end{array} \]" src="form_406.png"/>
</p>
<p> Step (2) is the one performed by <a class="el" href="parabolic__update_8c.html#ac2ee01ca2562ef042f459a017ad32e9d">ParabolicUpdate()</a>. By convention, parabolic fluxes are written with the plus sign when they are on the right hand side.</p>
<p>The <a class="el" href="parabolic__update_8c.html#aefbc26d62209abbbb901c7e763517192">ParabolicRHS()</a> function does the actual computation of the right hand side, in divergence form, of the parabolic (diffusion) operators only: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \pd{U}{t} = \nabla\cdot\Big(D\nabla U\Big) + S \]" src="form_222.png"/>
</p>
<p> Here <code>U</code> is a generic cell-centered quantity (like momentum, magnetic field or total energy) and <img class="formulaInl" alt="$\vec{F} = D\nabla U$" src="form_223.png"/> is the corresponding flux and <code>S</code> is the source terms (including geometrical source terms). Contributions may simultaneously come from ambipolar diffusion, resistivity, thermal conduction and viscosity computed, respectively, by the functions AD_Flux(), <a class="el" href="res__flux_8c.html#aef1a202b25a9d576a7c18b84eabaaca9">ResistiveFlux()</a>, <a class="el" href="tc_8h.html#ad8037dc7e79c320d7d73675ba32a42c6">TC_Flux()</a> and <a class="el" href="viscous__flux_8c.html#a31c33dec32c1df552e1ae01460c9cba3">ViscousFlux()</a>.</p>
<p>For resistivity / ambipolar diffusion / Hall MHD, we use the divergence form of the induction equation when updating cell-centered magnetic fields: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \pd{\vec{B}}{t} = - \nabla\times\vec{E} \equiv -\nabla\cdot\tens{M} \qquad\mathrm{where}\qquad \tens{M} = \left(\begin{array}{ccc} 0 &amp; E_z &amp; -E_y \\ \noalign{\medskip} -E_z &amp; 0 &amp; E_x \\ \noalign{\medskip} E_y &amp; -E_x &amp; 0 \end{array}\right) \qquad\mathrm{or\quad also}\qquad \tens{M}_{ij} = (\vec{E}\times\hvec{e}_i)\cdot\hvec{e}_j \]" src="form_224.png"/>
</p>
<p> which is valid for any electric vector while <img class="formulaInl" alt="$\tens{M}$" src="form_225.png"/> is an antisymmetric tensor. Note that in curvilinear geometries, the right hand side contains source terms. In cylindrical coordinates, for instance: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{array}{lcl} (\nabla\cdot\tens{M})_r &amp;=&amp;\DS \frac{1}{r}\pd{}{r}(rM_{rr}) + \frac{1}{r}\pd{M_{\phi r}}{\phi} + \pd{M_{zr}}{z} - \frac{M_{\phi\phi}}{r} \\ \noalign{\medskip} (\nabla\cdot\tens{M})_\phi &amp;=&amp;\DS \frac{1}{r}\pd{}{r}(rM_{r\phi}) + \frac{1}{r}\pd{M_{\phi\phi}}{\phi} + \pd{M_{z\phi}}{z} + \frac{M_{\phi r}}{r} \\ \noalign{\medskip} (\nabla\cdot\tens{M})_z &amp;=&amp;\DS \frac{1}{r}\pd{}{r}(rM_{rz}) + \frac{1}{r}\pd{M_{\phi z}}{\phi} + \pd{M_{zz}}{z} \end{array} \]" src="form_226.png"/>
</p>
<p>This function is intended for operator split algorithms (STS, RKL) as well as explicit time stepping.</p>
<p>This function also computes the inverse diffusion time step by adding, for each diffusion equation, contributions coming from different directions: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Delta t_{p}^{-1} = \max\left[\frac{D_{i+\HALF} + D_{i-\HALF}}{2\Delta x^2} + \frac{D_{j+\HALF} + D_{j-\HALF}}{2\Delta y^2} + \frac{D_{k+\HALF} + D_{k-\HALF}}{2\Delta z^2}\right] \]" src="form_227.png"/>
</p>
<p> where <img class="formulaInl" alt="$\eta_{x,y,z}$" src="form_228.png"/> are the diffusion coefficients available at cell interfaces in the three directions, respectively, and the maximum is taken over the local processor grid.</p>
<dl class="section date"><dt>Date</dt><dd>July 10, 2019 </dd></dl>
<dl class="section author"><dt>Authors</dt><dd>A. Mignone (<a href="#" onclick="location.href='mai'+'lto:'+'mig'+'no'+'ne@'+'to'+'.in'+'fn'+'.it'; return false;">migno<span style="display: none;">.nosp@m.</span>ne@t<span style="display: none;">.nosp@m.</span>o.inf<span style="display: none;">.nosp@m.</span>n.it</a>)<br />
 B. Vaidya Z. Ahmane </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aefbc26d62209abbbb901c7e763517192"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ParabolicRHS </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_data.html">Data</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Data_Arr&#160;</td>
          <td class="paramname"><em>dU</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_r_box.html">RBox</a> *&#160;</td>
          <td class="paramname"><em>domBox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double **&#160;</td>
          <td class="paramname"><em>aflux</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeStepping</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_grid.html">Grid</a> *&#160;</td>
          <td class="paramname"><em>grid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">d</td><td>Pointer to the PLUTO data structure. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">dU</td><td>3D array containing the conservative right hand sides </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">domBox</td><td>A pointer to an <a class="el" href="struct_r_box.html">RBox</a> structure defining the zones of the domain to be updated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">aflux</td><td>A 2D pointer to store fluxes (needed by Chombo) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timeStepping</td><td>an integer specifying the time stepping method (= EXPLICIT / STS / RKL) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>the time step </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grid</td><td>pointer to <a class="el" href="struct_grid.html">Grid</a> structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>On output it returns the maximum diffusion coefficients among all dissipative term over the local processor grid. </dd></dl>

</div>
</div>
<a class="anchor" id="ac2ee01ca2562ef042f459a017ad32e9d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ParabolicUpdate </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="struct_data.html">Data</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Data_Arr&#160;</td>
          <td class="paramname"><em>dU</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_r_box.html">RBox</a> *&#160;</td>
          <td class="paramname"><em>domBox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double **&#160;</td>
          <td class="paramname"><em>aflux</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structtime_step.html">timeStep</a> *&#160;</td>
          <td class="paramname"><em>Dts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_grid.html">Grid</a> *&#160;</td>
          <td class="paramname"><em>grid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>It is called only by explicit schemes.</p>
<dl class="section note"><dt>Note</dt><dd>When the entropy switch is enabled, the right hand side is comuted as a combination of energy, momentum and magnetic feld rhs: <p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Delta\sigma = \Delta t\frac{\Gamma-1}{\rho^{\Gamma-1}} \left[\Delta E - \vec{v}\cdot\Delta\vec{m} - \vec{B}\cdot\Delta{\vec{B}} \right] \]" src="form_407.png"/>
</p>
 where <img class="formulaInl" alt="$\sigma = p/\rho^{\Gamma-1}$" src="form_408.png"/> is the conserved entropy.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">d</td><td>Pointer to the PLUTO data structure. When set to <code>NULL</code>, the right hand side is not recomputed, and the most recent computed value of rhs[] is employed (useful for CTU algorithms). </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dU</td><td>Array of conservative rhs to be updated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">domBox</td><td>A pointer to an <a class="el" href="struct_r_box.html">RBox</a> structure defining the zones of the domain to be updated </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">aflux</td><td>A 2D pointer to store fluxes (needed by Chombo) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>The time step increment </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Dts</td><td>Pointer to the <a class="el" href="structtime_step.html">timeStep</a> structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grid</td><td>Pointer to the grid structure </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Sep 14 2020 21:28:57 for PLUTO by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
